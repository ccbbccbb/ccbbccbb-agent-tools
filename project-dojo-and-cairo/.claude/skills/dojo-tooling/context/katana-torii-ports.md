# Katana & Torii Port Configuration

## Service Ports

| Service | Port | Purpose |
|---------|------|---------|
| **Katana** | 5050 | Local Starknet blockchain |
| **Torii** | 8080 | GraphQL/gRPC indexer |

## Katana (Local Blockchain)

### Port: 5050

Katana is the local Starknet sequencer for development.

**Endpoints:**
- RPC: `http://localhost:5050`
- Health: `http://localhost:5050/health`

**Check if running:**
```bash
lsof -i :5050
```

**Test endpoint:**
```bash
curl -s http://localhost:5050
```

**Start manually:**
```bash
katana --port 5050
```

## Torii (GraphQL Indexer)

### Port: 8080

Torii indexes the Dojo world and provides GraphQL/gRPC APIs.

**Endpoints:**
- GraphQL: `http://localhost:8080/graphql`
- gRPC: `http://localhost:8080/grpc`

**Check if running:**
```bash
lsof -i :8080
```

**Test endpoint:**
```bash
curl -s http://localhost:8080/graphql
```

**Start manually (requires world address):**
```bash
torii --world $(cat .world_address) --rpc http://localhost:5050
```

## Environment Variables

These are set by the session-start hook:

```bash
STARKNET_RPC="http://localhost:5050"
DOJO_TORII_URL="http://localhost:8080"
```

## Process ID Files

Services write their PIDs to these files for management:

| File | Service |
|------|---------|
| `.katana_pid` | Katana process ID |
| `.torii_pid` | Torii process ID |

## World Address

The world address is stored in `.world_address`:

```bash
# Read world address
cat .world_address

# Generated by
sozo migrate
```

**Note:** Torii requires the world address to start. If `.world_address` doesn't exist, run `sozo migrate` first.

## Health Check Script

```bash
# Quick health check
KATANA=$(lsof -ti:5050 > /dev/null 2>&1 && echo "UP" || echo "DOWN")
TORII=$(lsof -ti:8080 > /dev/null 2>&1 && echo "UP" || echo "DOWN")

echo "Katana: $KATANA"
echo "Torii: $TORII"
```

## Port Conflict Resolution

If a port is already in use:

```bash
# Find what's using the port
lsof -i :5050

# Kill the process
kill -9 $(lsof -ti:5050)

# Or use different ports (advanced)
katana --port 5051
torii --port 8081
```
